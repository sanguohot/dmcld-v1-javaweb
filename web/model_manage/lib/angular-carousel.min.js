/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.0.9 - 2013-10-11
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("angular-carousel", ["ngMobile"]), angular.module("angular-carousel").directive("rnCarouselIndicators", [function () {
	return{restrict: "A", replace: !0, scope: {items: "=", index: "="}, template: '<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-class="{active: $index==$parent.index}">‚óè</span></div>'}
}]), angular.module("angular-carousel").directive("rnCarouselInfinite", ["$parse", "$compile", function (t) {
	return{restrict: "EA", transclude: !0, replace: !0, scope: !0, template: "<ul rn-carousel rn-carousel-buffered><li ng-transclude></li></ul>", compile: function (e, n) {
		var i = n.rnCarouselCurrent + " in items";
		return e.children("li").attr("ng-repeat", i), function (e, n, i) {
			e.items = [t(i.rnCarouselCurrent)(e)], e.$watchCollection("carouselCollection.position", function (n) {
				t(i.rnCarouselCurrent).assign(e.$parent, e.items[n])
			})
		}
	}}
}]), angular.module("angular-carousel").directive("rnCarousel", ["$compile", "$parse", "$swipe", "$document", "$window", "CollectionManager", function (t, e, n, i, r, s) {
	var o = 0;
	return{restrict: "A", scope: !0, compile: function (a, l) {
		a.addClass("rn-carousel-slides");
		var u, c, f = a.children("li")[0].attributes, h = f["ng-repeat"], d = !1;
		if (h || (h = f["data-ng-repeat"]), h || (h = f["x-ng-repeat"]), h) {
			var p = h.value.match(/^\s*(.+)\s+in\s+(.*?)\s*(\s+track\s+by\s+(.+)\s*)?$/), g = p[1], m = p[3] || "";
			u = p[2], d = angular.isDefined(l.rnCarouselBuffered), h.value = g + " in carouselCollection.cards " + m
		} else {
			var x = a.children("li");
			if (2 > x.length)throw Error("carousel: cannot find the ngRepeat attribute OR no childNodes detected");
			u = "fakeArray", c = Array.prototype.slice.apply(x)
		}
		return function (a, l, f) {
			function h(t) {
				var e = angular.element(t).css("transform").match(/translate3d\((-?\d+(?:px)?),\s*(-?\d+(?:px)?),\s*(-?\d+(?:px)?)\)/);
				return e ? e.slice(1, 3) : [0, 0, 0]
			}

			function p(t) {
				!t.target || t.target !== j[0] || "transform" !== t.propertyName && "-webkit-transform" !== t.propertyName && "-moz-transform" !== t.propertyName || (a.$apply(function () {
					x(), a.carouselCollection.adjustBuffer(), I(!0)
				}), j.css(v(h(j[0]), !0)))
			}

			function g(t, e) {
				function n() {
					E = !0, a.carouselCollection[t](e, !0)
				}

				a.$$phase ? n() : a.$apply(n)
			}

			function m(t, e) {
				var n = "after" === t ? "push" : "unshift";
				e && (angular.isObject(e.promise) ? e.promise.then(function (t) {
					t && g(n, t)
				}) : angular.isFunction(e.then) ? e.then(function (t) {
					t && g(n, t)
				}) : g(n, e))
			}

			function x() {
				var t = a.carouselCollection.position, n = a.carouselCollection.getLastIndex(), i = null;
				0 === t && angular.isDefined(f.rnCarouselPrev) && (i = e(f.rnCarouselPrev)(a, {item: a.carouselCollection.cards[0]}), m("before", i)), t === n && angular.isDefined(f.rnCarouselNext) && (i = e(f.rnCarouselNext)(a, {item: a.carouselCollection.cards[a.carouselCollection.cards.length - 1]}), m("after", i))
			}

			function C(t, e) {
				var n = {};
				return n[t] = e, angular.forEach(W, function (i) {
					n["-" + i.toLowerCase() + "-" + t] = e
				}), n
			}

			function v(t, e) {
				return e ? C("transform", "translate3d(" + t + "px,0,0)") : C("transform", "translate(" + t + "px,0)")
			}

			function y() {
				b(), I()
			}

			function b() {
				k.css("width", "auto"), E = !0;
				var t = j.children("li");
				return D = 0 === t.length ? j[0].getBoundingClientRect().width : t[0].getBoundingClientRect().width, k.css("width", D + "px"), D
			}

			function I(t) {
				E = !!t || E, 0 === D && b(), A = Math.round(a.carouselCollection.getRelativeIndex() * -D), E === !0 ? j.removeClass("rn-carousel-animate").addClass("rn-carousel-noanimate").css(v(A, !1)) : j.removeClass("rn-carousel-noanimate").addClass("rn-carousel-animate").css(v(A, !0)), E = !1
			}

			function w(t) {
				if (i.unbind("mouseup", M), 0 === D && b(), S > 1) {
					var e = a.carouselCollection.getLastIndex(), n = a.carouselCollection.position, r = z > A ? 1 : -1, s = Math.min(Math.max(0, n + r), e), o = t.x - L;
					D * T >= Math.abs(o) && (s = n);
					var l = n !== s;
					l ? a.$apply(function () {
						angular.isDefined(f.rnCarouselCycle) && (a.carouselCollection.position = s, I()), a.carouselCollection.goTo(s, !0)
					}) : a.$apply(function () {
						I()
					})
				}
				S = 0
			}

			function $(t) {
				var e = k[0].getBoundingClientRect(), n = t.x > e.left && t.x < e.left + D && t.y > e.top && t.y < e.top + e.height;
				return n
			}

			function M(t) {
				w({x: t.clientX, y: t.clientY})
			}

			o++;
			var B = "rn-carousel-" + o, S = 0, L = 0, z = 0, A = 0, T = .1, D = 0, E = !0, j = l.wrap("<div id='" + B + "' class='rn-carousel-container'></div>"), k = j.parent();
			c && (a.fakeArray = c);
			var N = e(u), O = {}, R = 0;
			if (f.rnCarouselIndex) {
				var P = e(f.rnCarouselIndex);
				angular.isFunction(P.assign) ? (a.$watch("carouselCollection.index", function (t) {
					P.assign(a.$parent, t)
				}), R = P(a), a.$parent.$watch(P, function (t) {
					void 0 !== t && a.carouselCollection.goToIndex(t, !0)
				})) : isNaN(f.rnCarouselIndex) || (R = parseInt(f.rnCarouselIndex, 10))
			}
			angular.isDefined(f.rnCarouselCycle) && (O.cycle = !0), O.index = R, d && (O.bufferSize = 3, O.buffered = !0), a.carouselCollection = s.create(O), a.$watch("carouselCollection.updated", function (t) {
				t && I()
			});
			var F = !1;
			a.$watch(N, function (t) {
				a.carouselCollection.setItems(t, F), F = !0, 0 === D && b(), I()
			}), angular.isDefined(f.rnCarouselWatch) && a.$watch(u, function (t) {
				a.carouselCollection.setItems(t, !1), F = !0, 0 === D && b(), I()
			}, !0);
			var W = ["webkit", "moz"];
			if (j[0].addEventListener("webkitTransitionEnd", p, !1), j[0].addEventListener("transitionend", p, !1), window.addEventListener("orientationchange", y), window.addEventListener("resize", y), angular.isDefined(f.rnCarouselIndicator)) {
				var X = t("<div id='" + B + "-indicator' index='carouselCollection.index' items='carouselCollection.items' data-rn-carousel-indicators class='rn-carousel-indicator'></div>")(a);
				k.append(X)
			}
			var Y = null, q = r.jasmine || "iPad" == r.navigator.platform ? 0 : 50;
			n.bind(j, {start: function (t) {
				0 === S && (S = 1, L = t.x), i.bind("mouseup", M)
			}, move: function (t) {
				if (!$(t))return w(t), void 0;
				if (0 !== S) {
					var e = t.x - L;
					if (1 === S && 0 !== e)S = 2, z = A; else if (2 === S) {
						var n = (new Date).getTime();
						if (Y && q > n - Y)return;
						Y = n;
						var i = a.carouselCollection.getLastIndex(), r = a.carouselCollection.position, s = 1;
						(0 === r && t.x > L || r === i && L > t.x) && (s = 3), A = z + e / s, j.css(v(A, !0)).removeClass("rn-carousel-animate").addClass("rn-carousel-noanimate")
					}
				}
			}, end: function (t) {
				w(t)
			}})
		}
	}}
}]), angular.module("angular-carousel").service("CollectionManager", [function () {
	function t(t) {
		var e, n = {bufferSize: 0, bufferStart: 0, buffered: !1, cycle: !1, cycleOffset: 0, index: 0, position: 0, items: [], cards: [], updated: null, debug: !1};
		if (t)for (e in t)n[e] = t[e];
		for (e in n)this[e] = n[e];
		angular.extend(this, n, t), this.init()
	}

	return t.prototype.log = function () {
		this.debug && console.log.apply(console, arguments)
	}, t.prototype.getPositionFromIndex = function (t) {
		return(t + this.cycleOffset) % this.length()
	}, t.prototype.goToIndex = function (t, e) {
		if (t = Math.max(0, Math.min(t, this.getLastIndex())), this.updated && t === this.index)return this.log("skip position change(same)"), !1;
		var n = this.getPositionFromIndex(t);
		return this.goTo(n, e)
	}, t.prototype.goTo = function (t, e) {
		if (this.log("goto start", t, e), 0 === this.length())return this.log("empty, skip gotoIndex"), void 0;
		t = Math.max(0, Math.min(t, this.getLastIndex()));
		var n = !1;
		this.cycle && (0 === t ? (this.log("cycleAtBeginning", t), this.cycleAtBeginning(), t = 1, this.cycleOffset++, n = !0) : t === this.getLastIndex() && (this.log("cycleAtEnd", t), this.cycleAtEnd(), t--, this.cycleOffset--, n = !0), this.cycleOffset %= this.length()), this.position = Math.max(0, Math.min(t, this.getLastIndex()));
		var i = (this.position - this.cycleOffset + this.length()) % this.length();
		this.index = Math.max(0, Math.min(i, this.getLastIndex())), e || this.adjustBuffer(), n || (this.updated = new Date)
	}, t.prototype.next = function () {
		this.cycle ? this.goTo((this.position + 1) % this.length()) : this.goTo(Math.min(this.position + 1, this.getLastIndex()))
	}, t.prototype.prev = function () {
		if (this.cycle)this.goTo((this.position - 1 + this.length()) % this.length()); else {
			var t = this.length() > 0 ? Math.max(0, (this.position - 1) % this.length()) : 0;
			this.goTo(t)
		}
	}, t.prototype.setBufferSize = function (t) {
		this.log("setBufferSize", t), this.bufferSize = t, this.adjustBuffer()
	}, t.prototype.isBuffered = function () {
		return this.buffered
	}, t.prototype.getRelativeIndex = function () {
		var t = Math.max(0, Math.min(this.getLastIndex(), this.position - this.bufferStart));
		return t
	}, t.prototype.adjustBuffer = function () {
		var t = (this.getLastIndex() + 1 - this.bufferSize) % this.length();
		this.log("maxBufferStart", t), this.bufferStart = Math.max(0, Math.min(t, this.position - 1)), this.cards = this.items.slice(this.bufferStart, this.bufferStart + this.bufferSize), this.log("adjustBuffer from", this.bufferStart, "to", this.bufferStart + this.bufferSize)
	}, t.prototype.length = function () {
		return this.items.length
	}, t.prototype.getLastIndex = function () {
		var t = Math.max(0, this.length() - 1);
		return t
	}, t.prototype.init = function () {
		this.setBufferSize(this.isBuffered() ? this.bufferSize : this.length()), this.length() > 0 && this.goToIndex(this.index)
	}, t.prototype.setItems = function (t, e) {
		this.log("setItems", t, e), e && (this.index = 0, this.position = 0), this.items = t || [], this.init()
	}, t.prototype.cycleAtEnd = function () {
		this.push(this.items.shift())
	}, t.prototype.push = function (t, e) {
		this.log("push item(s)", t, e), this.items.push(t), e && (this.adjustBuffer(), this.updated = new Date), this.buffered || this.bufferSize++
	}, t.prototype.unshift = function (t, e) {
		this.log("unshift item(s)", t, e), this.items.unshift(t), this.buffered || this.bufferSize++, e && (this.position++, this.adjustBuffer(), this.updated = new Date)
	}, t.prototype.cycleAtBeginning = function () {
		this.unshift(this.items.pop())
	}, {create: function (e) {
		return new t(e)
	}}
}]);